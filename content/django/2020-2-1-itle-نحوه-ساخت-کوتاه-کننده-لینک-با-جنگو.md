---
utid: 20200201123633
date: 2020-02-01 12:36:33
title: نحوه ساخت کوتاه کننده لینک در جنگو
_index: create-link-shortening-in-django
categories:
  -
tags:
  -
---

یکی از چیزهایی که خیلی برام چالش برانگیز و جذاب هست نحوه کار کوتاه کننده های لینک هست و تصمیم گرفتم با جنگو یدونه برای خودم بسازم و دیدم بد نیست مرحل کار و به اصطلاح logic که استفاده کردم توش رو با شما به اشتراک بزارم .

### کوتاه کننده های لینک چطور کار میکنند ؟

کوتاه کننده های لینک در اصل یک string با طول زیاد رو تبدیل میکنند به یک سری از کاراکتر ها های فشرده و کوتاه که خیلی کوتاه تر از طول string ورودی هستند و برای این کار از hashing استفاده میکنند . در اصل اگه بخوام به صورت جز به جز توضیح بدم ٬ روال کار به این شکل هست که ما از کاربر link رو میگیریم و hash میکنیم و این hash رو در اصطلاح map میکنیم به link اصلی ٬ کار تمام است .

![block](/django/images/hash.jpg)

  

#### چرا از hash استفاده میکنیم در صورتی که میتونیم از یه string که random هست استفاده کنیم ؟

خوب در نظر بگیرین به جای اینکه link اصلی رو hash کنیم ٬ بیایم یه string که random هست بسازیم و به link اصلی به اصطلاح map کنیم .

در اینجا اگه دیتابیس ما دچار مشکل بشه دیگه نمیتونیم به string هایی که random ساختیم دسترسی داشته باشیم و در اصل کار پروژه تموم میشه :)

یه نکته ای دیگه ای که هست این که hash ها برای هر ورودی متفاوت هستند و امکان نداری برای ۲ ورودی متفاوت یک مقدار یکسان تولید کنند پس به ما تضمین میدن هیچ وقت ۲ تا لینک متفاوت نمیتونند یه لینک کوتاه شده یکسان داشته باشن .

### ساخت مدل مورد نیاز :

اصلی ترین قسمت پروژه نحوه ساخت تابع hash کننده هست . در زیر میتونین مدلی که برای این کار ساختم رو ببینین :

```
class URL(models.Model):
    original_url = models.CharField(max_length=300, unique= True)
    shortened_url = models.CharField(max_length=30, unique =  True)
    
    def shorten_url(self):
        self.shortened_url = self.__fnv_hash(self.original_url)
        
        if(len(self.shortened_url) >= len(self.original_url)):
            self.shortened_url =  self.original_url
        
        
    @staticmethod
    def __fnv_hash(key):
        h = 2166136261
        
        for k in key:
            h = (h*16777619)^ord(k)
        
        # Return 8 bit URL
        return base64.encode(h%281474976710656)
    
    def __str__(self):
        return models.Model.__str__(self)  
```

خوب میبینین که مدل من ۲ تا فیلد داره :

- link اصلی
- لینک کوتاه شده یا در اصل hash لینک اصلی

در اینجا من یه مدلی ساختم و از کاربر لینک اصلی رو میگیرم و بعد با استفاده از تابع shorten_url در اصل hash لینک اصلی رو حساب میکنم و در فیلد  shortened_url میریزم . حال خود تابع shorten_url میاد از یه تابع private دیگه به اسم fnv_hash استفاده میکنه که اصل کار این هست و میاد یه ورودی میگیره و اون رو به hash تبدیل میکنه .

در اینجا کار تمام است و حالا نیاز دارین چند تا view داشته باشین :

- یکی برای گرفتن ورودی link اصلی از کاربر و ساخت object از مدل URL
- یه view باید بسازین که مثلا اگه کاربر لینک زیر رو وارد کرد شما بیاین و قسمت sdfj23sdf رو در دیتابیس سرچ کنید ( این یه hash هست مثلا در فیلد shortened_url مدل URL ذخیره شده ) و باهاش به link اصلی برسین و در نهایت کاربران رو به link اصلی redirect کنید .

```
www.your_domain.com/sdfj23sdf
```

امیدوارم بدرد بخور بوده باشه و اگه مشکلی در پیاده سازی داشتین حتما در قسمت کامنت های این پست بیان کنید تا بتونم کمکی بهتون بکنم .