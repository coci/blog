<!DOCTYPE html>
<html lang="Farsi">
<head>
  <title>سروش صفری | ساخت سرور گیت</title>

  <meta charset="utf-8">
  <meta name="description" content="سلام ، این وبلاگ منه">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta property="og:type" content="website">
  <meta property="og:title" content="ساخت سرور گیت">
  <meta property="og:url" content="https://koky.ir/farsi/">
  <meta property="og:site_name" content="سروش صفری">
  <meta property="og:description" content="&lt;p&gt;در پی تحریم هایی که github برای ایرانی ها اعمال کرده دیگه کاربران ایرانی اجازه ساخت repository به صورت private ندارن و همچنین با توجه به فیلتر بودن gitlab تصمیم گرفتم تا یه سرور گیت شخصی برای خودم راه اندازی کنم و بعد از کلی تست ابزارهای مختلف در اخر به بهترین گزینه موجود که با کمترین دردسر میشه ازش استفاده کرد رسیدم ٬ چیزی به اسم Gitea .

من تو این بلاگ پست قصد دارم مراحل ساخت  یه  گیت سرور شخصی با استفاده از Gitea رو که طی کردم با شما به اشتراک بزارم .

پیش نیاز :

پیش نیاز های این اموزش :

ubuntu server  : من تو این اموزش از ubuntu server 18.04 استفاده کردم 
nginx
نصب داکر بروی سرور
داشتن ح&lt;/p&gt;">
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="ساخت سرور گیت">
  <meta name="twitter:description" content="&lt;p&gt;در پی تحریم هایی که github برای ایرانی...">

  <link rel="alternative" href="/farsi/atom.xml" title="سروش صفری" type="application/atom+xml">
  <link rel="short icon" href="">
  <link rel="stylesheet" href="/static/theme/sallar/css/style.css" type="text/css">

  <!-- Global site tag (gtag.js) - Google Analytics -->
	<script async src="https://www.googletagmanager.com/gtag/js?id=UA-115996537-1"></script>
	<script>
  	window.dataLayer = window.dataLayer || [];
  	function gtag(){dataLayer.push(arguments);}
  	gtag('js', new Date());

  	gtag('config', 'UA-115996537-1');
	</script>


</head>
<body>

<!-- Header -->
<header>
  <section class="container">
    <nav>
      <h1>
        <a href="/" class="logo">سروش صفری</a>
      </h1>
      <ul>
        

          <li><a href="/python/" target="python">آموزش پایتون</a></li>
          <li><a href="/django" target="django">آموزش جنگو</a></li>
          <li><a href="/farsi/">فارسی</a></li>
          <li><a href="/blog">English</a></li>
        
      </ul>
    </nav>
  </section>
</header>
<!-- /Header -->

<section id="content" class="container">

  <article id="create-git-server" class="article article-type-post" itemscope itemprop="blogPost">
    <h2 class="title" itemprop="name">ساخت سرور گیت</h2>

    
      <h4 class="time">
    <time datetime="2020-01-20 13:15:57" itemprop="datePublished">دوشنبه، ۳۰ دی ۱۳۹۸</time>
  </h4>
    

    <section class="content">
    <a name="more"></a>
<p>در پی تحریم هایی که github برای ایرانی ها اعمال کرده دیگه کاربران ایرانی اجازه ساخت repository به صورت private ندارن و همچنین با توجه به فیلتر بودن gitlab تصمیم گرفتم تا یه سرور گیت شخصی برای خودم راه اندازی کنم و بعد از کلی تست ابزارهای مختلف در اخر به بهترین گزینه موجود که با کمترین دردسر میشه ازش استفاده کرد رسیدم ٬ چیزی به اسم Gitea .</p>

<p>من تو این بلاگ پست قصد دارم مراحل ساخت  یه  گیت سرور شخصی با استفاده از Gitea رو که طی کردم با شما به اشتراک بزارم .</p>

<h3 id="پیش_نیاز_:">پیش نیاز :</h3>

<p>پیش نیاز های این اموزش :</p>

<ul>
<li>ubuntu server  : من تو این اموزش از ubuntu server 18.04 استفاده کردم </li>
<li>nginx</li>
<li>نصب داکر بروی سرور</li>
<li>داشتن حداقل دانش نسبت به command line سرور</li>
</ul>

<h3 id="نصب_nginx_:">نصب nginx :</h3>

<p>خوب در اولین گام به سرور با استفاده از ssh متصل بشین . سپس برای نصب nginx دستور زیر رو وارد کنید :</p>

<pre><code class="language-python">$ sudo apt update
$ sudo apt install nginx
</code></pre>

<p>حالا با دستور زیر دسترسی های لازم رو به nginx بدین :</p>

<pre><code class="language-python">$ sudo ufw allow 'Nginx Full'
</code></pre>

<h3 id="docker_:">docker :</h3>

<p>ما برای نصب gitea روی سرور از داکر استفاده میکنیم ( روش های دیگه ای هم داره اما نصب به وسیله داکر راحت ترین و بی دردسر ترین روش موجود میباشد ) .</p>

<p>خوب برای نصب داکر یه مشکلی هست و اونم این که داکر در ایران تحریم  و اگه سرور شما برای ایران باشه نمیتونین docker رو نصب کنید پس برای راه حل این قضیه میتونید dns خودتون رو عوض کنین تا بتونین داکر رو نصب کنید .</p>

<p><strong>(اگه سرور شما برای ایران میباشد مراحل زیر رو طی کنید)</strong></p>

<p>برای عوض کردن dns سرور دستور زیر رو وارد کنید :</p>

<pre><code class="language-python">$   sudo nano etc/resolv.conf
</code></pre>

<p>در ویراشگر متن تمام nameserver هارو پاک کنید و این ۲ مقادیر رو وارد کنید :</p>

<pre><code class="language-python">nameserver 178.22.122.100
nameserver 185.51.200.2
</code></pre>

<p>حال با استفاده از دکمه ترکیبی ctrl-x فایل رو سیو کنید و خارج شوید .</p>

<h4 id="نصب_docker_:">نصب Docker :</h4>

<p>برای نصب داکر بروی سرور دستورات زیر رو وارد کنید :</p>

<p><strong>(دقت کنید دستورات رو به ترتیب وارد کنید)</strong></p>

<pre><code class="language-python">$   sudo apt install apt-transport-https ca-certificates curl software-properties-common
$   curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add -
</code></pre>

<p>سپس دستورات زیر رو وارد کنید :</p>

<pre><code class="language-python">$   sudo add-apt-repository "deb [arch=amd64] https://download.docker.com/linux/ubuntu bionic stable"
</code></pre>

<p>و در اخر دستورات زیر رو وارد کنید :</p>

<pre><code class="language-python">$   sudo apt update
$   apt-cache policy docker-ce
$   sudo apt install docker-ce
</code></pre>

<h4 id="نصب_docker-compose_:">نصب docker-compose :</h4>

<p>حال نیازمند نصب docker-compose هستیم . برای این کار هم دستورات زیر رو وارد کنید :</p>

<pre><code class="language-python">$   sudo curl -L https://github.com/docker/compose/releases/download/1.21.2/docker-compose-`uname -s`-`uname -m` -o /usr/local/bin/docker-compose
</code></pre>

<p>پس از دانلود docker-compose با استفاده از دستور بالا ٬ دستور زیر را وارد کنید :</p>

<pre><code class="language-python">$   sudo chmod +x /usr/local/bin/docker-compose
</code></pre>

<p>برای اینکه بفهمیم docker-compose به درستی نصب شده دستور زیر رو وارد کنید :</p>

<pre><code class="language-python">$   docker-compose --version
</code></pre>

<p>و باید چیزی شبیه به این رو ببینید :</p>

<pre><code class="language-python">$   docker-compose version 1.21.2, build a133471
</code></pre>

<h3 id="نصب_gitea_:">نصب Gitea :</h3>

<p>در این مرحله یه پوشه به اسم gitea بسازین و برین داخل پوشه :</p>

<pre><code class="language-python">$   mkdir gitea
$   cd gitea/
</code></pre>

<p>حال با دستور زیر یه فایل به اسم docker-compose.yml در داخل پوشه gitea بسازین :</p>

<pre><code class="language-python">$   touch docker-compose.yml
</code></pre>

<p>سپس با استفاده از دستور زیر این فایل رو با ویرایشگر متن باز کنید :</p>

<pre><code class="language-python">$   nano docker-compose.yml
</code></pre>

<p>حال متن زیر رو به درستی در ویراشگر باز شده وارد کنید :</p>

<p>به چند نکته مهم باید دقت داشته باشین :</p>

<ul>
<li>در مورد محتویات فایل زیر توضیحی نمیدم چون این مربوط به docker میباشد و از موضوع این بحث خارج است .</li>
<li>اگه دانش در مورد داکر دارین میتونین فایل زیر رو ویرایش کنید .</li>
</ul>

<pre><code class="language-python">version: "3"

networks:
  valhalla:
    external: false

services:
  server:
    image: gitea/gitea:latest
    environment:
      - APP_NAME="git Hub"
      - USER_UID=2005
      - USER_GID=2005
      - DB_TYPE=postgres
      - DB_HOST=gitea_db:5432
      - DB_NAME=gitea_db
      - DB_USER=gitea
      - DB_PASSWD=AbcD23324234234
    restart: always
    networks:
      - valhalla
    volumes:
      - gitea_data:/data
    ports:
      - "3000:3000"
      - "222:32223"
    depends_on:
      - gitea_db

  gitea_db:
    image: postgres:9.6
    restart: always
    environment:
      - POSTGRES_DB=gitea_db
      - POSTGRES_USER=gitea
      - POSTGRES_PASSWORD=AbcD23324234234
    networks:
      - valhalla
    volumes:
      - postgres_data:/var/lib/postgresql/data

volumes:
  gitea_data:
  postgres_data:
</code></pre>

<p>حال با استفاده از دکمه ترکیبی ctrl-x فایل رو سیو کنید و خارج شوید . سپس دستور زیر رو وارد کنید تا gitea با استفاده از فایلی که ساختیم نصب بشه :</p>

<pre><code class="language-python">$   sudo docker-compose up -d
</code></pre>

<p>پس از زدن کد بالا باید چیزی شبیه نوشته پایین رو ببینید :( بعد از زدن دستور بالا مقداری صبر کنید ٬ چون تقریبا نصب ۱۰ دقیقه طول میکشه)</p>

<pre><code class="language-python">.........
Creating gitea_gitea_db_1 ... done
Creating gitea_server_1   ... done
</code></pre>

<p>کار نصب gitea به پایان رسیده است و ادرس زیر رو در مرورگرتون وارد کنید :</p>

<p>(دقت کنید به جای your_ip_addreess باید ادرس ip سرور خودتون رو وارد کنید)</p>

<pre><code class="language-python">http://your_ip_addreess:3000
</code></pre>

<p>باید صفحه زیر رو ببینید :</p>

<p><img src="/farsi/images/gitea1.jpg" alt="gitea" id="gitea"></p>

<p>حالا از منوی سمت راست بالای صفحه بروی دکمه sing in کلیک کنید و با صفحه مثل زیر رو به رو میشید :</p>

<p><strong>(دقت کنید این صفحه فقط برای اولین بار برای شما نمایش داده میشه و اگه اطلاعات رو به درستی وارد نکنید باید تمامی مراحل بالا رو از اول انجام بدید .)</strong></p>

<p><img src="/farsi/images/gitea2.jpg" alt="gitea" id="gitea"></p>

<p>خوب در بخش database settings نیاز به تغییر هیچ کدوم نیست  و همین طور با مقادیر پیش فرضی که پر شده است رها کنید ٬ ولی در پایین صفحه در قسمت General Settings مقادیر رو به شکل زیر تغییر بدین :</p>

<p>( دقت کنید در مقادیر پایین هرجا که من ip رو 37.152.181.14 وارد کردم شما باید به جاش ip سرور خودتون رو وارد کنید )</p>

<p><img src="/farsi/images/gitea3.jpg" alt="gitea" id="gitea"></p>

<p>حال در پایین صفحه دکمه install رو بزنین .</p>

<h3 id="تنظیمات_nginx:">تنظیمات nginx:</h3>

<p>حال وقتش رسیده که تنظیمات nginx رو وارد کنیم تا ازین پس بتونیم gitea رو روی پورت 80 سرور بازکنیم .</p>

<p>برای این کار دستور زیر رو در ترمینال سرور وارد کنید :</p>

<pre><code class="language-python">$   sudo nano /etc/nginx/sites-available/gitea
</code></pre>

<p>بعد در ویرایشگر متن باز شده کدهای زیر رو وارد کنید :</p>

<p>( دقت کنید در قسمت پایین که من server_name رو 37.152.181.14 وارد کردم شما باید به جاش ip سرور خودتون رو وارد کنید )</p>

<pre><code class="language-python">server {
    listen 80;
    server_name 37.152.181.14;
  client_max_body_size 100M;
    location = /favicon.ico { access_log off; log_not_found off; }

    location / {
        include proxy_params;
        proxy_pass http://127.0.0.1:3000;
    }
}
</code></pre>

<p>حال با استفاده از دکمه ترکیبی ctrl-x فایل رو سیو کنید و خارج شوید . سپس دستور زیر رو وارد کنید :</p>

<pre><code class="language-python">$   sudo ln -s /etc/nginx/sites-available/gitea /etc/nginx/sites-enabled
</code></pre>

<p>حالا با زدن دستور زیر nginx رو ریستارت کنید تا تنظیمات بالا اعمال بشه :</p>

<pre><code class="language-python">$   sudo systemctl restart nginx
</code></pre>

<p>کار تمام است و اگه ip سرور رو بدون پورت 3000 باز کنید میبینید که gitea باز میشه و میتونین ازش استفاده کنید .</p>

<p>در صفحه gitea از منوی register یه اکانت کاربری برای خودتون بسازین و پس از وارد شدن با اون اکانت میتونین از منوی بالای صفحه برا خودتون یک repository بسازین و ازش استفاده کنید .</p>
  </section>

<!-- AddToAny BEGIN -->
<div class="a2a_kit a2a_kit_size_32 a2a_default_style">
<a class="a2a_dd" href="https://www.addtoany.com/share"></a>
<a class="a2a_button_twitter"></a>
</div>
<script async src="https://static.addtoany.com/menu/page.js"></script>
<!-- AddToAny END -->

    
      <script>
var idcomments_acct = 'edab4112dbf8f45d3904228b8f395f7d';
var idcomments_post_id;
var idcomments_post_url;
</script>
<span id="IDCommentsPostTitle" style="display:none"></span>
<script type='text/javascript' src='https://www.intensedebate.com/js/genericCommentWrapperV2.js'></script>
    
  </article>

</section>

<!-- Paging -->
<section class="pagination">
  <nav class="container">
    
      <a></a>
    
      <a class="extend next" rel="next" href="/farsi/دوری-از-مجازی/">
        <i>-></i>
        <span>دوری از مجازی</span>
      </a>
  </nav>
</section>
<!-- /Paging -->

<!-- /Content -->
<!-- Footer -->
<footer>
    <!--<section class="copyright">

    </section>-->
    <section class="container">
      <div class="delimiter">
        <a href="/" class="logo">
          <img src="/static/theme/sallar/img/logo.svg">
        </a>
      </div>
      <p>
        
          ۱۳۹۸<br>
          مطالب تحت لیسانس <a href="http://creativecommons.org/licenses/by-nc-nd/3.0/" rel="license" target="_blank">کریتیو کامنز</a> منتشر می‌شوند.
        
        <br>
        powered with 💜 by <a href="https://miraxy.github.io">Mira</a>
      </p>
    </section>
</footer>
<!-- /Footer -->

<!-- Scripts -->
<script src="/static/theme/sallar/js/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
</body>
</html>